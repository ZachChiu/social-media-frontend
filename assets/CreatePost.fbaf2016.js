import{_ as w,p as y,u as k,q as f,g as x,r as C,o as p,c as m,a as b,b as s,y as B,A as T,i as _,F as I,j as v}from"./index.e9d10c37.js";import{T as j}from"./Title.38bca7b0.js";import{I as P,f as N}from"./file.f282a0fa.js";import{p as V}from"./posts.b2e1eba5.js";const L={components:{Title:j,ImgCropper:P},setup(){const l=y(),t=k();let n=f(!1),e=f(!1);const c=x({img:null,outputSize:.98,outputType:"png",fixed:!0,autoCrop:!0,fixedNumber:[1,1],centerBox:!0}),a=x({image:null,content:null,imageBase64:null});return{form:a,isLoading:n,option:c,isCropping:e,getImg:r=>{const d=r.target.files[0];d.type==="image/jpeg"&&(c.outputType="jpeg");const i=new FileReader;i.onloadend=function(){const h=i.result;c.img=h,e.value=!0},i.readAsDataURL(d)},onClickCrop:r=>{a.imageBase64=r,e.value=!1},createPost:async()=>{if(!n.value){if(!a.content){l.error("\u5167\u5BB9\u4E0D\u5B8C\u5168");return}try{n.value=!0;const r={content:a.content};if(a.imageBase64){const d=await a.imageBase64.split(",")[1],i=await N.upload(d);r.image=i}await V.createPost(r),l.success("\u767C\u6587\u6210\u529F!"),t.push({name:"posts-wall"})}catch{l.error("\u767C\u6587\u5931\u6557")}finally{n.value=!1}}}}}},F={class:"card p-8"},R=s("label",{class:"block mb-2",for:"content"},"\u8CBC\u6587\u5167\u5BB9",-1),S={class:"flex mt-4"},U={class:"w-32 md:w-24 text-white bg-dark rounded-shadow py-1 text-center cursor-pointer"},q=v("\u4E0A\u50B3\u5716\u7247 "),A={key:0,class:"relative rounded-shadow overflow-hidden mt-4"},D=["src"],z=["disabled"],E=v(" \u9001\u51FA\u8CBC\u6587 "),M={key:0,class:"fa-solid fa-spinner animate-spin ml-1"};function G(l,t,n,e,c,a){const g=C("Title"),u=C("ImgCropper");return p(),m(I,null,[b(g,{title:"\u5F35\u8CBC\u52D5\u614B"}),s("div",F,[R,B(s("textarea",{name:"content",id:"content",rows:"5",placeholder:"\u8ACB\u8F38\u5165\u8CBC\u6587\u5167\u5BB9",required:"",autofocus:"",autocomplete:"off","onUpdate:modelValue":t[0]||(t[0]=o=>e.form.content=o),class:"py-4 px-5"},null,512),[[T,e.form.content]]),s("div",S,[s("label",U,[q,s("input",{type:"file",class:"hidden",accept:".png, .jpg, .jpeg",onChange:t[1]||(t[1]=(...o)=>e.getImg&&e.getImg(...o))},null,32)])]),e.form.imageBase64?(p(),m("div",A,[s("i",{class:"fa-solid fa-x absolute top-0 right-0 transition text-white text-opacity-50 hover:text-dark bg-dark bg-opacity-50 hover:bg-gray rounded-bl-2xl text-md flex items-center justify-center p-3 cursor-pointer",onClick:t[2]||(t[2]=o=>e.form.imageBase64=null)}),s("img",{class:"w-full",src:e.form.imageBase64,alt:""},null,8,D)])):_("",!0),s("button",{class:"bg-secondary text-dark hover:text-white hover:bg-primary disabled:bg-disabled disabled:text-white w-full lg:w-[323px] font-bold mx-auto mt-8 py-4 block card",disabled:e.isLoading,onClick:t[3]||(t[3]=(...o)=>e.createPost&&e.createPost(...o))},[E,e.isLoading?(p(),m("i",M)):_("",!0)],8,z)]),b(u,{option:e.option,isCropping:e.isCropping,"onUpdate:isCropping":t[4]||(t[4]=o=>e.isCropping=o),onCrop:e.onClickCrop},null,8,["option","isCropping","onCrop"])],64)}var Q=w(L,[["render",G]]);export{Q as default};
