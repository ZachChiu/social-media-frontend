import{T as P}from"./Title.7931d178.js";import{d as b,L as w,E}from"./EmptyCard.2cbc392b.js";import{_ as v,e as T,u as j,f as x,o as r,c as d,b as i,t as p,n as B,C as I,l as Y,m as D,g as M,q as S,r as f,a as y,F as g,h as C,k as h}from"./index.b287f4de.js";import{p as L}from"./posts.4104fa84.js";const F={props:{post:{type:Object,default(){return{}}}},setup(o,{emit:t}){const e=T(),s=j(),k=x(()=>e.getters["users/user"]),a=x(()=>o.post.likes.includes(k.value._id));return{dayjs:b,hasLikePost:a,onClickPersonal:()=>{s.push({name:"personal-wall",params:{userId:o.post.user._id}})},toggleLike:()=>{o.post.isLoading||(a.value?t("unlike-post",o.post._id):t("like-post",o.post._id))},onClick2Post:()=>{s.push({name:"post",params:{postId:o.post._id}})}}}},N={class:"card p-4 flex items-end justify-between"},U={class:"flex items-center"},V=i("img",{class:"w-[40px] mr-4",src:I,alt:""},null,-1),q={class:"text-sm text-gray"},z={class:"flex items-center text-center"},A={key:0,class:"fa-solid fa-spinner text-primary animate-spin-slow text-xl"},O={key:1,class:"fa-regular fa-thumbs-up text-xl"},R={class:"text-sm font-bold"},G=i("i",{class:"fa-regular fa-circle-right text-xl"},null,-1),H=i("p",{class:"text-sm font-bold"},"\u67E5\u770B",-1),J=[G,H];function K(o,t,e,s,k,a){return r(),d("div",N,[i("div",U,[V,i("div",null,[i("p",{class:"link cursor-pointer",onClick:t[0]||(t[0]=(...n)=>s.onClickPersonal&&s.onClickPersonal(...n))},p(e.post.user.name),1),i("p",q," \u767C\u6587\u6642\u9593\uFF1A "+p(s.dayjs(e.post.createdAt).format("YYYY/MM/DD mm:ss")),1)])]),i("div",z,[i("div",{class:B(["mr-5 md:mr-9 cursor-pointer hover:text-gray flex flex-col items-center",s.hasLikePost?"text-primary":"text-secondary"]),onClick:t[1]||(t[1]=(...n)=>s.toggleLike&&s.toggleLike(...n))},[e.post.isLoading?(r(),d("i",A)):(r(),d("i",O)),i("p",R,p(s.hasLikePost?"\u53D6\u6D88":"\u6309\u8B9A"),1)],2),i("div",{class:"cursor-pointer text-dark hover:text-gray",onClick:t[2]||(t[2]=(...n)=>s.onClick2Post&&s.onClick2Post(...n))},J)])])}var Q=v(F,[["render",K]]);const W={components:{Title:P,LikesCard:Q,LoadingCard:w,EmptyCard:E},setup(){const o=Y();let t=D(!1),e=M([]);const s=async()=>{try{t.value=!0;const a=await L.getLikeList();e.push(...a)}catch{o.error("\u8F09\u5165\u6309\u8B9A\u8CBC\u6587\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u6574\u7406")}finally{t.value=!1}},k=async(a,n)=>{let l={};const c=e.findIndex(u=>u._id===a);e[c].isLoading=!0;try{n==="like"?l=await L.likePost(a):l=await L.unlikePost(a),e[c].likes=l.data.likes}catch{o.error(n==="like"?"\u53D6\u6D88\u6309\u8B9A\u5931\u6557":"\u6309\u8B9A\u5931\u6557")}finally{e[c].isLoading=!1}};return S(()=>{s()}),{likeList:e,isLoading:t,toggleLike:k}}};function X(o,t,e,s,k,a){const n=f("Title"),l=f("LoadingCard"),c=f("EmptyCard"),u=f("LikesCard");return r(),d(g,null,[y(n,{title:"\u6211\u6309\u8B9A\u7684\u8CBC\u6587"}),s.isLoading?(r(),d(g,{key:0},C(3,(_,m)=>y(l,{key:m,class:"mb-4 last:mb-0"})),64)):s.likeList.length===0?(r(),h(c,{key:1,state:"\u7121\u6309\u8B9A\u4EFB\u4F55\u8CBC\u6587"})):(r(!0),d(g,{key:2},C(s.likeList,_=>(r(),h(u,{key:_._id,post:_,class:"mb-4 last:mb-0",onUnlikePost:t[0]||(t[0]=m=>s.toggleLike(m,"unlike")),onLikePost:t[1]||(t[1]=m=>s.toggleLike(m,"like"))},null,8,["post"]))),128))],64)}var es=v(W,[["render",X]]);export{es as default};
