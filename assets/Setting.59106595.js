import{T as F}from"./Title.38bca7b0.js";import{_ as I,e as H,p as M,q as x,s as L,g as C,f as J,v as Z,x as G,r as y,o as n,c,b as a,i as f,y as b,A as P,t as _,F as k,h as V,I as K,a as B,H as j,k as O,j as T,J as Q,m as U,n as W}from"./index.e9d10c37.js";import{I as X,f as Y}from"./file.f282a0fa.js";import{c as m,r as $,m as z,u as A}from"./index.esm.9b7edc48.js";const ee={components:{ImgCropper:X},setup(){const u=H(),t=M();let l=x(!1),e=x(!1),i=x(null);const g=L([{key:"male",text:"\u7537\u6027"},{key:"female",text:"\u5973\u6027"},{key:"none",text:"\u4FDD\u7559"}]);let o=C({name:"",sex:"male",photo:""});const s={name:{required:m.withMessage("\u8ACB\u8F38\u5165\u66B1\u7A31",$),minLength:m.withMessage("\u66B1\u7A31\u6700\u5C11\u9700\u8F38\u5165\u5169\u500B\u5B57\u5143",z(2)),$lazy:!0}},p=A(s,o),r=J(()=>u.getters["users/user"]),v=C({img:null,outputSize:.98,outputType:"png",fixed:!0,autoCrop:!0,fixedNumber:[1,1],centerBox:!0});Z(r,d=>{d&&(o.name=d.name,o.sex=d.sex,o.photo=d.photo||"")},{immediate:!0});const S=d=>{const w=d.target.files[0];w.type==="image/jpeg"&&(v.outputType="jpeg");const h=new FileReader;h.onloadend=function(){const E=h.result;v.img=E,e.value=!0},h.readAsDataURL(w)},D=async()=>{if(p.value.$touch(),!(p.value.$invalid||l.value))try{l.value=!0;const d={name:o.name,sex:o.sex,photo:o.photo};if(i.value){const w=await i.value.split(",")[1],h=await Y.upload(w);d.photo=h}await j.updateProfile(d),await u.dispatch("users/getUser"),t.success("\u66F4\u65B0\u6210\u529F"),i.value=null}catch(d){t.error(d.response.data.message||"\u66F4\u65B0\u5931\u6557")}finally{l.value=!1}},q=()=>i.value?i.value:o.photo?o.photo:O,N=d=>{i.value=d,e.value=!1},R=()=>{i.value=null,o.photo=null};return G(()=>{o.name=r.value.name,o.sex=r.value.sex,o.photo=r.value.photo||""}),{sexs:g,form:o,isLoading:l,updateInfo:D,getPhoto:q,user:r,isCropping:e,option:v,onClickCrop:N,onClickDeletePhoto:R,getImg:S,v$:p,photoBase64:i}}},te={class:"info"},oe={class:"relative w-[105px] mx-auto rounded-full"},se=["src"],ae={class:"flex justify-center mt-4"},re={class:"w-32 md:w-24 text-white bg-dark rounded-shadow py-1 text-center cursor-pointer"},ne=T("\u4E0A\u50B3\u5716\u7247 "),le={class:"mb-8"},ie=a("label",{for:"name",class:"block mb-1"},"\u66B1\u7A31",-1),de={key:0,class:"text-danger mt-2 text-xs text-left absolute"},ce=a("p",{class:"mb-1 last:mb-0"},"\u6027\u5225",-1),ue={class:"flex"},pe=["id","value","onUpdate:modelValue"],me=["for"],fe=["disabled"],ge=T(" \u9001\u51FA\u66F4\u65B0 "),ve={key:0,class:"fa-solid fa-spinner animate-spin ml-1"};function he(u,t,l,e,i,g){const o=y("ImgCropper");return n(),c(k,null,[a("div",te,[a("div",oe,[e.form.photo||e.photoBase64?(n(),c("i",{key:0,class:"fa-solid fa-x absolute bottom-0 right-0 transition text-dark text-opacity-50 hover:text-dark bg-gray-dark rounded-full text-xs flex items-center justify-center w-7 h-7 cursor-pointer",onClick:t[0]||(t[0]=(...s)=>e.onClickDeletePhoto&&e.onClickDeletePhoto(...s))})):f("",!0),a("img",{class:"rounded-full",src:e.getPhoto(),alt:""},null,8,se)]),a("div",ae,[a("label",re,[ne,a("input",{type:"file",class:"hidden",accept:".png, .jpg, .jpeg",onChange:t[1]||(t[1]=(...s)=>e.getImg&&e.getImg(...s))},null,32)])]),a("div",le,[ie,b(a("input",{type:"text",id:"name",class:"px-6 py-2","onUpdate:modelValue":t[2]||(t[2]=s=>e.form.name=s),onChange:t[3]||(t[3]=s=>e.v$.name.$touch())},null,544),[[P,e.form.name]]),e.v$.name.$invalid?(n(),c("p",de,_(e.v$.name.$errors[0].$message),1)):f("",!0)]),ce,a("div",ue,[(n(!0),c(k,null,V(e.sexs,s=>(n(),c("div",{class:"mr-5 last:mr-0",key:s.key},[b(a("input",{type:"radio",id:s.key,name:"sex",value:s.key,"onUpdate:modelValue":p=>e.form.sex=p},null,8,pe),[[K,e.form.sex]]),a("label",{class:"pl-3",for:s.key},_(s.text),9,me)]))),128))]),a("button",{class:"bg-secondary text-dark hover:text-white hover:bg-primary disabled:bg-disabled disabled:text-white w-full font-bold mx-auto mt-8 py-4 block rounded-shadow",disabled:e.isLoading,onClick:t[4]||(t[4]=(...s)=>e.updateInfo&&e.updateInfo(...s))},[ge,e.isLoading?(n(),c("i",ve)):f("",!0)],8,fe)]),B(o,{option:e.option,isCropping:e.isCropping,"onUpdate:isCropping":t[5]||(t[5]=s=>e.isCropping=s),onCrop:e.onClickCrop},null,8,["option","isCropping","onCrop"])],64)}var xe=I(ee,[["render",he]]);const _e={setup(){const u=M();let t=x(!1),l=C({password:"",confirmPassword:""});const e=r=>new RegExp("[A-Z]").test(r),i=r=>new RegExp("[a-z]").test(r),g=r=>l.password===r,o={password:{required:m.withMessage("\u8ACB\u8F38\u5165\u5BC6\u78BC",$),minLength:m.withMessage("\u5BC6\u78BC\u6700\u5C11\u70BA 8 \u78BC",z(8)),uppercase:m.withMessage("\u6700\u5C11\u9808\u5305\u542B\u4E00\u500B\u5927\u5BEB",e),lowercase:m.withMessage("\u6700\u5C11\u9808\u5305\u542B\u4E00\u500B\u5C0F\u5BEB",i),$lazy:!0},confirmPassword:{required:m.withMessage("\u8ACB\u8F38\u5165\u5BC6\u78BC",$),sameAs:m.withMessage("\u5BC6\u78BC\u4E0D\u76F8\u7B26",g),$lazy:!0}},s=A(o,l);return{isLoading:t,form:l,onClickUpdate:async()=>{if(s.value.$touch(),!(s.value.$invalid||t.value))try{t.value=!0,await j.updatePassword(l),l.password="",l.confirmPassword="",s.value.$reset(),u.success("\u4FEE\u6539\u6210\u529F")}catch(r){u.error(r.response.data.message||"\u4FEE\u6539\u5931\u6557")}finally{t.value=!1}},v$:s}}},we={class:"password"},ye={class:"mb-8 relative"},be=a("label",{for:"password",class:"mb-1 block"},"\u8F38\u5165\u65B0\u5BC6\u78BC",-1),ke={key:0,class:"text-danger mt-2 text-xs text-left absolute"},Ce={class:"mb-8 relative"},Pe=a("label",{for:"confirmPassword",class:"mb-1 block"},"\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC",-1),$e={key:0,class:"text-danger mt-2 text-xs text-left absolute"},Ie=["disabled"],Te=T(" \u91CD\u8A2D\u5BC6\u78BC "),Ue={key:0,class:"fa-solid fa-spinner text-white animate-spin-slow"};function Me(u,t,l,e,i,g){return n(),c("div",we,[a("form",null,[a("div",ye,[be,b(a("input",{type:"password",name:"password",id:"password",class:"bg-gray-light w-full font-Azeret py-3 px-5",placeholder:"\u8F38\u5165\u65B0\u5BC6\u78BC","onUpdate:modelValue":t[0]||(t[0]=o=>e.form.password=o),onBlur:t[1]||(t[1]=o=>e.v$.password.$touch())},null,544),[[P,e.form.password]]),e.v$.password.$invalid?(n(),c("p",ke,_(e.v$.password.$errors[0].$message),1)):f("",!0)]),a("div",Ce,[Pe,b(a("input",{type:"password",name:"confirmPassword",id:"confirmPassword",class:"bg-gray-light w-full font-Azeret py-3 px-5",placeholder:"\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC","onUpdate:modelValue":t[2]||(t[2]=o=>e.form.confirmPassword=o),onBlur:t[3]||(t[3]=o=>e.v$.confirmPassword.$touch())},null,544),[[P,e.form.confirmPassword]]),e.v$.confirmPassword.$invalid?(n(),c("p",$e,_(e.v$.confirmPassword.$errors[0].$message),1)):f("",!0)]),a("button",{class:"bg-secondary text-dark hover:text-white hover:bg-primary disabled:bg-disabled disabled:text-white w-full font-bold mx-auto py-4 block rounded-shadow",disabled:e.isLoading,onClick:t[4]||(t[4]=Q((...o)=>e.onClickUpdate&&e.onClickUpdate(...o),["prevent"]))},[Te,e.isLoading?(n(),c("i",Ue)):f("",!0)],8,Ie)])])}var Le=I(_e,[["render",Me]]);const Ve={components:{Title:F,Info:xe,Password:Le},setup(){const u=L([{key:"info",text:"\u8CC7\u6599\u4FEE\u6539"},{key:"password",text:"\u91CD\u8A2D\u5BC6\u78BC"}]);let t=x("info");return{tabs:u,currentTtab:t}}},Be={class:"tabs flex"},je=["onClick"],ze={class:"card px-[30px] lg:px-[105px] py-8 rounded-t-none"};function Ae(u,t,l,e,i,g){const o=y("Title"),s=y("Info"),p=y("Password");return n(),c(k,null,[B(o,{title:"\u4FEE\u6539\u500B\u4EBA\u8CC7\u6599"}),a("div",Be,[(n(!0),c(k,null,V(e.tabs,r=>(n(),c("div",{key:r.jey,class:W(["tab bg-white border hover:bg-gray-light border-gray border-opacity-30 rounded-t-lg py-2 px-6 cursor-pointer",{active:e.currentTtab===r.key}]),onClick:v=>e.currentTtab=r.key},_(r.text),11,je))),128))]),a("div",ze,[e.currentTtab==="info"?(n(),U(s,{key:0})):f("",!0),e.currentTtab==="password"?(n(),U(p,{key:1})):f("",!0)])],64)}var Re=I(Ve,[["render",Ae],["__scopeId","data-v-6a7857a2"]]);export{Re as default};
